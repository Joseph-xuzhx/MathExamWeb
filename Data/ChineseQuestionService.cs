using System;
using MathExamWeb.Data.Models;
using MathExamWeb.Data.Services.Interfaces;

namespace MathExamWeb.Data
{
    public class ChineseQuestionService : IQuestionService
    {
        private readonly Random _random = new Random();

        public Question GenerateQuestion(DifficultyLevel? difficulty = null)
        {
            int type = _random.Next(1, 5); // 1: 名句填空 2: 反义词 3: 近义词 4: 选择题
            switch (type)
            {
                case 1:
                    return GenerateFamousSentenceFill();
                case 2:
                    return GenerateAntonym();
                case 3:
                    return GenerateSynonym();
                default:
                    return GenerateMultipleChoice();
            }
        }

        public List<Question> GetQuestionsByDifficulty(DifficultyLevel difficulty)
        {
            return new List<Question>();
        }

        public List<string> GetCategories()
        {
            return new List<string> { "名句填空", "反义词", "近义词" };
        }

        public Dictionary<string, int> GetCategoryStatistics()
        {
            return new Dictionary<string, int>
            {
                { "名句填空", 4 },
                { "反义词", 3 },
                { "近义词", 3 }
            };
        }

        private Question GenerateFamousSentenceFill()
        {
            var items = new (string stem, string answer, string exp)[]
            {
                ("补全诗句：海内存知己，天涯____。", "若比邻", "出自王勃《送杜少府之任蜀州》，意为朋友相知，远在天涯也像在身旁。"),
                ("补全诗句：会当凌绝顶，一览____山小。", "众", "出自杜甫《望岳》，登到最高处，俯瞰群山都显得渺小。"),
                ("补全诗句：谁言寸草心，报得三____晖。", "春", "出自孟郊《游子吟》，寸草比喻子女之心，难报母亲春晖般的恩情。"),
                ("补全诗句：欲穷千里目，更____一层楼。", "上", "出自王之涣《登鹳雀楼》，想要看得更远，就要更上一层楼。")
            };
            var pick = items[_random.Next(items.Length)];
            return new Question
            {
                Text = pick.stem,
                CorrectAnswer = pick.answer,
                Explanation = pick.exp,
                IsFractionAnswer = false,
                Category = "名句填空",
                Difficulty = DifficultyLevel.Medium
            };
        }

        private Question GenerateAntonym()
        {
            var items = new (string word, string antonym, string exp)[]
            {
                ("勤奋", "懒惰", "勤奋的反义词是懒惰，表示不爱劳动、不用功。"),
                ("谦虚", "骄傲", "谦虚的反义词是骄傲，表示自满自大。"),
                ("光明", "黑暗", "光明与黑暗是一对常见的反义词。")
            };
            var pick = items[_random.Next(items.Length)];
            return new Question
            {
                Text = $"写出\"{pick.word}\"的反义词：",
                CorrectAnswer = pick.antonym,
                Explanation = pick.exp,
                IsFractionAnswer = false,
                Category = "反义词",
                Difficulty = DifficultyLevel.Easy
            };
        }

        private Question GenerateSynonym()
        {
            var items = new (string word, string synonym, string exp)[]
            {
                ("高兴", "快乐", "高兴的近义词是快乐，表示心情愉悦。"),
                ("美丽", "漂亮", "美丽的近义词是漂亮，表示外表好看。"),
                ("勇敢", "无畏", "勇敢的近义词是无畏，表示不惧怕困难。")
            };
            var pick = items[_random.Next(items.Length)];
            return new Question
            {
                Text = $"写出\"{pick.word}\"的近义词：",
                CorrectAnswer = pick.synonym,
                Explanation = pick.exp,
                IsFractionAnswer = false,
                Category = "近义词",
                Difficulty = DifficultyLevel.Easy
            };
        }

        private Question GenerateMultipleChoice()
        {
            var items = new (string question, string correct, string[] options, string exp)[]
            {
                // 成语题（15道）
                (
                    "下列哪个成语用来形容学习刻苦？",
                    "悬梁刺股",
                    new[] { "悬梁刺股", "守株待兔", "画蛇添足", "掩耳盗铃" },
                    "悬梁刺股形容刻苦学习，出自孙敬和苏秦的故事。"
                ),
                (
                    "\"草木皆兵\"这个成语出自哪个历史事件？",
                    "淝水之战",
                    new[] { "淝水之战", "赤壁之战", "官渡之战", "长平之战" },
                    "草木皆兵出自淝水之战，形容人在惊慌时疑神疑鬼。"
                ),
                (
                    "\"亡羊补牢\"告诉我们什么道理？",
                    "及时改正错误还不算晚",
                    new[] { "及时改正错误还不算晚", "要提前做好准备", "不要相信别人", "做事要果断" },
                    "亡羊补牢比喻出了问题后想办法补救，还不算太晚。"
                ),
                (
                    "\"画蛇添足\"比喻什么？",
                    "做多余的事反而不好",
                    new[] { "做多余的事反而不好", "做事要认真", "要抓住机会", "不要半途而废" },
                    "画蛇添足比喻做了多余的事，反而不恰当。"
                ),
                (
                    "\"刻舟求剑\"讽刺了什么样的人？",
                    "思想僵化不知变通",
                    new[] { "思想僵化不知变通", "做事不认真", "胆小怕事", "贪得无厌" },
                    "刻舟求剑讽刺思想僵化、不知随机应变的人。"
                ),
                (
                    "\"滥竽充数\"的意思是？",
                    "没有真才实学却混在行家里",
                    new[] { "没有真才实学却混在行家里", "学习不认真", "做事马虎", "喜欢吹牛" },
                    "滥竽充数比喻没有真才实学的人混在行家里充数。"
                ),
                (
                    "\"叶公好龙\"比喻什么行为？",
                    "表面喜欢其实害怕",
                    new[] { "表面喜欢其实害怕", "真心喜欢", "装模作样", "半途而废" },
                    "叶公好龙比喻表面喜欢某事物，实际上并不真正喜欢。"
                ),
                (
                    "\"愚公移山\"体现了什么精神？",
                    "坚持不懈的精神",
                    new[] { "坚持不懈的精神", "聪明才智", "谦虚谨慎", "急中生智" },
                    "愚公移山体现了坚持不懈、持之以恒的精神。"
                ),
                (
                    "\"对牛弹琴\"比喻什么？",
                    "对不懂的人讲深奥的道理",
                    new[] { "对不懂的人讲深奥的道理", "音乐很动听", "牛很聪明", "弹琴技艺高超" },
                    "对牛弹琴比喻对不懂的人讲深奥的道理是白费力气。"
                ),
                (
                    "\"井底之蛙\"用来比喻什么样的人？",
                    "见识短浅的人",
                    new[] { "见识短浅的人", "勤奋好学的人", "胆小怕事的人", "骄傲自满的人" },
                    "井底之蛙比喻见识短浅、眼界狭窄的人。"
                ),
                (
                    "\"东施效颦\"告诉我们什么道理？",
                    "盲目模仿适得其反",
                    new[] { "盲目模仿适得其反", "要多学习别人", "要坚持自我", "要谦虚好学" },
                    "东施效颦告诉我们盲目模仿别人会适得其反。"
                ),
                (
                    "\"杞人忧天\"形容什么样的人？",
                    "不必要的担心",
                    new[] { "不必要的担心", "深谋远虑", "粗心大意", "乐观向上" },
                    "杞人忧天比喻不必要的忧虑和担心。"
                ),
                (
                    "\"拔苗助长\"的教训是？",
                    "违背规律适得其反",
                    new[] { "违背规律适得其反", "要帮助别人", "做事要快", "不能偷懒" },
                    "拔苗助长告诉我们违背事物发展规律会适得其反。"
                ),
                (
                    "\"掩耳盗铃\"比喻什么行为？",
                    "自欺欺人",
                    new[] { "自欺欺人", "聪明机智", "谨慎小心", "胆大妄为" },
                    "掩耳盗铃比喻自己欺骗自己，明明掩盖不了还要掩盖。"
                ),
                (
                    "\"南辕北辙\"告诉我们什么？",
                    "行动与目标相反",
                    new[] { "行动与目标相反", "要坚持不懈", "要听从劝告", "方向很重要" },
                    "南辕北辙比喻行动和目的正好相反，结果离目标越来越远。"
                ),

                // 诗词题（12道）
                (
                    "\"春眠不觉晓\"的下一句是？",
                    "处处闻啼鸟",
                    new[] { "处处闻啼鸟", "疑是地上霜", "花落知多少", "低头思故乡" },
                    "出自孟浩然《春晓》：春眠不觉晓，处处闻啼鸟。"
                ),
                (
                    "\"床前明月光\"的下一句是？",
                    "疑是地上霜",
                    new[] { "疑是地上霜", "举头望明月", "低头思故乡", "春风又绿江南岸" },
                    "出自李白《静夜思》：床前明月光，疑是地上霜。"
                ),
                (
                    "\"飞流直下三千尺\"的下一句是？",
                    "疑是银河落九天",
                    new[] { "疑是银河落九天", "桃花潭水深千尺", "不及汪伦送我情", "春风不度玉门关" },
                    "出自李白《望庐山瀑布》：飞流直下三千尺，疑是银河落九天。"
                ),
                (
                    "\"黄河远上白云间\"的作者是？",
                    "王之涣",
                    new[] { "王之涣", "李白", "杜甫", "白居易" },
                    "出自王之涣《凉州词》：黄河远上白云间，一片孤城万仞山。"
                ),
                (
                    "\"劝君更尽一杯酒\"的下一句是？",
                    "西出阳关无故人",
                    new[] { "西出阳关无故人", "春风不度玉门关", "天涯共此时", "明月照我还" },
                    "出自王维《送元二使安西》：劝君更尽一杯酒，西出阳关无故人。"
                ),
                (
                    "\"朝辞白帝彩云间\"描写的是哪里？",
                    "长江三峡",
                    new[] { "长江三峡", "黄河", "洞庭湖", "西湖" },
                    "出自李白《早发白帝城》，描写从白帝城到江陵的长江三峡。"
                ),
                (
                    "\"接天莲叶无穷碧\"的下一句是？",
                    "映日荷花别样红",
                    new[] { "映日荷花别样红", "春来江水绿如蓝", "山色空蒙雨亦奇", "疑是银河落九天" },
                    "出自杨万里《晓出净慈寺送林子方》：接天莲叶无穷碧，映日荷花别样红。"
                ),
                (
                    "\"小荷才露尖尖角\"的下一句是？",
                    "早有蜻蜓立上头",
                    new[] { "早有蜻蜓立上头", "映日荷花别样红", "出淤泥而不染", "清水出芙蓉" },
                    "出自杨万里《小池》：小荷才露尖尖角，早有蜻蜓立上头。"
                ),
                (
                    "\"停车坐爱枫林晚\"的下一句是？",
                    "霜叶红于二月花",
                    new[] { "霜叶红于二月花", "春风又绿江南岸", "不知细叶谁裁出", "万紫千红总是春" },
                    "出自杜牧《山行》：停车坐爱枫林晚，霜叶红于二月花。"
                ),
                (
                    "\"欲穷千里目\"的下一句是？",
                    "更上一层楼",
                    new[] { "更上一层楼", "黄河入海流", "天涯共此时", "明月照我还" },
                    "出自王之涣《登鹳雀楼》：欲穷千里目，更上一层楼。"
                ),
                (
                    "\"等闲识得东风面\"的下一句是？",
                    "万紫千红总是春",
                    new[] { "万紫千红总是春", "春风又绿江南岸", "春色满园关不住", "红杏出墙来" },
                    "出自朱熹《春日》：等闲识得东风面，万紫千红总是春。"
                ),
                (
                    "\"春江潮水连海平\"的下一句是？",
                    "海上明月共潮生",
                    new[] { "海上明月共潮生", "江上秋风动客情", "天涯共此时", "明月何时照我还" },
                    "出自张若虚《春江花月夜》：春江潮水连海平，海上明月共潮生。"
                ),

                // 文学常识题（10道）
                (
                    "\"桃李满天下\"中的\"桃李\"指的是？",
                    "学生",
                    new[] { "学生", "朋友", "子女", "同事" },
                    "桃李满天下比喻学生众多，遍布各地。"
                ),
                (
                    "中国古代\"四大名著\"不包括？",
                    "《聊斋志异》",
                    new[] { "《聊斋志异》", "《红楼梦》", "《西游记》", "《三国演义》" },
                    "四大名著是《红楼梦》《西游记》《水浒传》《三国演义》。"
                ),
                (
                    "\"唐宋八大家\"中不包括？",
                    "李白",
                    new[] { "李白", "苏轼", "韩愈", "柳宗元" },
                    "唐宋八大家是散文家，李白是诗人不在其中。"
                ),
                (
                    "\"诗仙\"指的是哪位诗人？",
                    "李白",
                    new[] { "李白", "杜甫", "白居易", "李商隐" },
                    "李白被称为诗仙，杜甫被称为诗圣。"
                ),
                (
                    "《西游记》的作者是？",
                    "吴承恩",
                    new[] { "吴承恩", "罗贯中", "施耐庵", "曹雪芹" },
                    "《西游记》的作者是明代小说家吴承恩。"
                ),
                (
                    "\"三顾茅庐\"的故事出自？",
                    "《三国演义》",
                    new[] { "《三国演义》", "《水浒传》", "《西游记》", "《红楼梦》" },
                    "三顾茅庐是刘备三次拜访诸葛亮的故事，出自《三国演义》。"
                ),
                (
                    "\"但愿人长久，千里共婵娟\"是谁的诗句？",
                    "苏轼",
                    new[] { "苏轼", "李白", "杜甫", "白居易" },
                    "出自苏轼的《水调歌头·明月几时有》。"
                ),
                (
                    "中国传统节日\"端午节\"是为了纪念谁？",
                    "屈原",
                    new[] { "屈原", "岳飞", "文天祥", "诸葛亮" },
                    "端午节是为了纪念伟大诗人屈原。"
                ),
                (
                    "\"横眉冷对千夫指，俯首甘为孺子牛\"是谁的名句？",
                    "鲁迅",
                    new[] { "鲁迅", "茅盾", "巴金", "老舍" },
                    "这是鲁迅先生《自嘲》中的名句。"
                ),
                (
                    "\"春蚕到死丝方尽\"的下一句是？",
                    "蜡炬成灰泪始干",
                    new[] { "蜡炬成灰泪始干", "化作春泥更护花", "留取丹心照汗青", "只是朱颜改" },
                    "出自李商隐《无题》，比喻无私奉献的精神。"
                ),

                // 语言运用题（8道）
                (
                    "下列哪个词语是褒义词？",
                    "一丝不苟",
                    new[] { "一丝不苟", "狡猾多端", "虚情假意", "阳奉阴违" },
                    "一丝不苟形容做事认真细致，是褒义词。"
                ),
                (
                    "下列哪个标点符号用于表示引用或特殊含义？",
                    "引号",
                    new[] { "引号", "逗号", "句号", "问号" },
                    "引号用于表示引用、特殊含义或强调。"
                ),
                (
                    "下列哪个句子使用了比喻的修辞手法？",
                    "老师像蜡烛一样燃烧自己",
                    new[] { "老师像蜡烛一样燃烧自己", "天空很蓝", "小鸟在歌唱", "风吹树叶响" },
                    "比喻是用一种事物比作另一种事物，常用\"像\"\"仿佛\"等词。"
                ),
                (
                    "\"他跑得飞快\"运用了什么修辞手法？",
                    "夸张",
                    new[] { "夸张", "比喻", "拟人", "排比" },
                    "夸张是对事物进行夸大或缩小的描述。"
                ),
                (
                    "下列哪个句子有语病？",
                    "通过这次活动，使我受益匪浅",
                    new[] { "通过这次活动，使我受益匪浅", "春天来了，花儿开了", "我喜欢读书", "他是一个好学生" },
                    "这是典型的缺少主语的病句，应改为\"通过这次活动，我受益匪浅\"或\"这次活动使我受益匪浅\"。"
                ),
                (
                    "\"风儿在树叶间唱歌\"运用了什么修辞手法？",
                    "拟人",
                    new[] { "拟人", "比喻", "夸张", "排比" },
                    "拟人是把事物当作人来写，赋予人的动作或感情。"
                ),
                (
                    "下列词语中，哪个不是ABB式词语？",
                    "干干净净",
                    new[] { "干干净净", "白茫茫", "红彤彤", "黑乎乎" },
                    "干干净净是AABB式，白茫茫、红彤彤、黑乎乎是ABB式。"
                ),
                (
                    "\"桂林山水甲天下\"中的\"甲\"是什么意思？",
                    "第一",
                    new[] { "第一", "美丽", "著名", "珍贵" },
                    "甲在这里是第一、最好的意思。"
                ),

                // 字词题（7道）
                (
                    "下列哪个字的读音是错误的？",
                    "应(yīng)届生",
                    new[] { "应(yīng)届生", "供(gōng)应", "参(cān)加", "处(chǔ)理" },
                    "\"应届生\"中的\"应\"应该读yìng，不是yīng。"
                ),
                (
                    "\"兴高采烈\"中的\"兴\"读音是？",
                    "xìng",
                    new[] { "xìng", "xīng", "xǐng", "xíng" },
                    "在\"兴高采烈\"中，\"兴\"读xìng，表示兴致。"
                ),
                (
                    "下列词语中，哪个是错别字？",
                    "再接再励",
                    new[] { "再接再励", "川流不息", "精益求精", "一如既往" },
                    "应该是\"再接再厉\"，\"厉\"是磨刀石，比喻更加努力。"
                ),
                (
                    "\"美不胜收\"的\"胜\"是什么意思？",
                    "尽",
                    new[] { "尽", "胜利", "打败", "承受" },
                    "\"胜\"在这里是\"尽\"的意思，美不胜收就是美好的东西太多看不过来。"
                ),
                (
                    "下列哪组词语都是近义词？",
                    "美丽-漂亮",
                    new[] { "美丽-漂亮", "高兴-悲伤", "勇敢-胆小", "热情-冷淡" },
                    "美丽和漂亮意思相近，是近义词。"
                ),
                (
                    "\"毛遂自荐\"中的\"荐\"是什么意思？",
                    "推荐",
                    new[] { "推荐", "剑", "建议", "坚持" },
                    "荐是推荐的意思，毛遂自荐就是自己推荐自己。"
                ),
                (
                    "下列哪个词语的感情色彩是贬义？",
                    "虚伪",
                    new[] { "虚伪", "谦虚", "朴实", "真诚" },
                    "虚伪是贬义词，表示不真实、虚假。"
                )
            };

            var pick = items[_random.Next(items.Length)];

            // 打乱选项顺序
            var shuffledOptions = pick.options.OrderBy(x => _random.Next()).ToList();

            return new Question
            {
                Type = QuestionType.MultipleChoice,
                Text = pick.question,
                CorrectAnswer = pick.correct,
                Options = shuffledOptions,
                Explanation = pick.exp,
                IsFractionAnswer = false,
                Category = "选择题",
                Difficulty = DifficultyLevel.Medium
            };
        }
    }
}
